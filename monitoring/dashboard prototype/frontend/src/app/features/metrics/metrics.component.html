<div class="metrics-container">
  <!-- Header -->
  <div class="header">
    <h1>Metrics Dashboard</h1>
    <div class="header-actions">
      <button mat-icon-button (click)="refreshMetrics()" [disabled]="loading" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button (click)="exportMetrics()" [disabled]="loading" matTooltip="Export">
        <mat-icon>download</mat-icon>
      </button>
      <button mat-raised-button color="accent" (click)="createAlert()">
        <mat-icon>add_alert</mat-icon>
        Create Alert
      </button>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>Filters</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="filterForm" class="filters-form">
        <mat-form-field appearance="outline">
          <mat-label>Data Source</mat-label>
          <mat-select formControlName="source">
            <mat-option value="">All Sources</mat-option>
            <mat-option *ngFor="let adapter of adapters" [value]="adapter.name">
              {{ adapter.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Time Range</mat-label>
          <mat-select formControlName="timeRange">
            <mat-option value="15m">Last 15 minutes</mat-option>
            <mat-option value="1h">Last hour</mat-option>
            <mat-option value="6h">Last 6 hours</mat-option>
            <mat-option value="24h">Last 24 hours</mat-option>
            <mat-option value="7d">Last 7 days</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Aggregation</mat-label>
          <mat-select formControlName="aggregation">
            <mat-option value="avg">Average</mat-option>
            <mat-option value="sum">Sum</mat-option>
            <mat-option value="min">Minimum</mat-option>
            <mat-option value="max">Maximum</mat-option>
            <mat-option value="count">Count</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Interval</mat-label>
          <mat-select formControlName="interval">
            <mat-option value="1m">1 minute</mat-option>
            <mat-option value="5m">5 minutes</mat-option>
            <mat-option value="15m">15 minutes</mat-option>
            <mat-option value="1h">1 hour</mat-option>
            <mat-option value="1d">1 day</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-slide-toggle formControlName="autoRefresh">
          Auto Refresh (30s)
        </mat-slide-toggle>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading metrics...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshMetrics()">
      Retry
    </button>
  </div>

  <!-- Metrics Content -->
  <div *ngIf="!loading && !error" class="metrics-content">
    
    <!-- Charts Section -->
    <mat-card class="chart-card" *ngIf="metricSeries.length > 0">
      <mat-card-header>
        <mat-card-title>Metrics Chart</mat-card-title>
        <mat-card-subtitle>{{ metricSeries.length }} metric series</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <!-- Placeholder for chart component -->
          <div class="chart-placeholder">
            <mat-icon>timeline</mat-icon>
            <p>Chart visualization will be implemented with Chart.js or D3.js</p>
            <div class="chart-legend">
              <div *ngFor="let series of metricSeries" class="legend-item">
                <div class="legend-color"></div>
                <span>{{ series.name }}</span>
                <span *ngIf="series.metadata && series.metadata.unit" class="unit">({{ series.metadata.unit }})</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Metrics Table -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>Raw Metrics Data</mat-card-title>
        <mat-card-subtitle>{{ metrics.length }} data points</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="metrics" class="metrics-table">
            
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Metric Name</th>
              <td mat-cell *matCellDef="let metric">{{ metric.name }}</td>
            </ng-container>

            <!-- Value Column -->
            <ng-container matColumnDef="value">
              <th mat-header-cell *matHeaderCellDef>Value</th>
              <td mat-cell *matCellDef="let metric">
                {{ metric.value | number:'1.2-2' }}
                <span *ngIf="metric.unit" class="unit">{{ metric.unit }}</span>
              </td>
            </ng-container>

            <!-- Source Column -->
            <ng-container matColumnDef="source">
              <th mat-header-cell *matHeaderCellDef>Source</th>
              <td mat-cell *matCellDef="let metric">{{ metric.source }}</td>
            </ng-container>

            <!-- Timestamp Column -->
            <ng-container matColumnDef="timestamp">
              <th mat-header-cell *matHeaderCellDef>Timestamp</th>
              <td mat-cell *matCellDef="let metric">{{ metric.timestamp | date:'short' }}</td>
            </ng-container>

            <!-- Tags Column -->
            <ng-container matColumnDef="tags">
              <th mat-header-cell *matHeaderCellDef>Tags</th>
              <td mat-cell *matCellDef="let metric">
                <mat-chip-listbox *ngIf="metric.tags">
                  <mat-chip *ngFor="let tag of metric.tags | keyvalue">
                    {{ tag.key }}:{{ tag.value }}
                  </mat-chip>
                </mat-chip-listbox>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['name', 'value', 'source', 'timestamp', 'tags']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['name', 'value', 'source', 'timestamp', 'tags'];"></tr>
          </table>

          <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" 
                         [pageSize]="25"
                         showFirstLastButtons>
          </mat-paginator>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- No Data State -->
    <mat-card *ngIf="metrics.length === 0" class="no-data-card">
      <mat-card-content>
        <div class="no-data-content">
          <mat-icon>timeline</mat-icon>
          <h3>No Metrics Data</h3>
          <p>No metrics found for the selected filters. Try adjusting the time range or data source.</p>
          <button mat-raised-button color="primary" (click)="refreshMetrics()">
            Refresh Data
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
